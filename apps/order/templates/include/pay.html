{% load custom %}
<div class="clear"></div>
<div class="concent" style="margin-top: 10px">
    <!--地址 -->
    <div class="paycont">
        <div class="address">
            <h3>确认收货地址 </h3>
            <div class="control">
                <div class="tc-btn createAddr theme-login am-btn am-btn-danger">使用新地址</div>
            </div>
            <div class="clear"></div>
            <ul>
                {% for add in address %}
                    <div class="per-border"></div>
                    {% if forloop.first %}
                        <li class="user-addresslist defaultAddr">

                            <div class="address-left">
                                <div class="user DefaultAddr">

										<span class="buy-address-detail">
                   <span class="buy-user">{{ add.receiver }} </span>
										<span class="buy-phone">{{ add.phone }}</span>
										</span>
                                </div>
                                <div class="default-address DefaultAddr">
                                    <span class="buy-line-title buy-line-title-type">收货地址：</span>
                                    <span class="buy--address-detail">
								   <span class="province">{{ add.province }}</span>省
										<span class="city">{{ add.city }}</span>市
										<span class="dist">{{ add.area }}</span>区
										<span class="street">{{ add.detail_address }}</span>
										</span>
                                    </span>
                                </div>
                                <ins class="deftip">默认地址</ins>
                            </div>
                            <div class="address-right">
                                <a href="#">
                                    <span class="am-icon-angle-right am-icon-lg"></span></a>
                            </div>
                            <div class="clear"></div>

                            <div class="new-addr-btn">
                                <span class="new-addr-bar hidden">|</span>
                                <a href="#">编辑</a>
                                <span class="new-addr-bar">|</span>
                                <a href="javascript:void(0);" onclick="delClick(this);">删除</a>
                            </div>

                        </li>
                    {% else %}
                        <div class="per-border"></div>
                        <li class="user-addresslist">
                            <div class="address-left">
                                <div class="user DefaultAddr">

										<span class="buy-address-detail">
                   <span class="buy-user">{{ add.receiver }} </span>
										<span class="buy-phone">{{ add.phone }}</span>
										</span>
                                </div>
                                <div class="default-address DefaultAddr">
                                    <span class="buy-line-title buy-line-title-type">收货地址：</span>
                                    <span class="buy--address-detail">
								   <span class="province">{{ add.province }}</span>省
										<span class="city">{{ add.city }}</span>市
										<span class="dist">{{ add.area }}</span>区
										<span class="street">{{ add.detail_address }}</span>
										</span>

                                    </span>
                                </div>
                                <ins class="deftip hidden">默认地址</ins>
                            </div>
                            <div class="address-right">
                                <span class="am-icon-angle-right am-icon-lg"></span>
                            </div>
                            <div class="clear"></div>

                            <div class="new-addr-btn">
                                <a href="#">设为默认</a>
                                <span class="new-addr-bar">|</span>
                                <a href="#">编辑</a>
                                <span class="new-addr-bar">|</span>
                                <a href="javascript:void(0);" onclick="delClick(this);">删除</a>
                            </div>

                        </li>

                    {% endif %}
                {% endfor %}
            </ul>

            <div class="clear"></div>
        </div>
        <!--物流 -->
        <div class="logistics">
            <h3>选择物流方式</h3>
            <ul class="op_express_delivery_hot">
                <li data-value="yuantong" class="OP_LOG_BTN  "><i class="c-gap-right"
                                                                  style="background-position:0px -468px"></i>圆通<span></span>
                </li>
                <li data-value="shentong" class="OP_LOG_BTN  "><i class="c-gap-right"
                                                                  style="background-position:0px -1008px"></i>申通<span></span>
                </li>
                <li data-value="yunda" class="OP_LOG_BTN  "><i class="c-gap-right"
                                                               style="background-position:0px -576px"></i>韵达<span></span>
                </li>
                <li data-value="zhongtong" class="OP_LOG_BTN op_express_delivery_hot_last "><i class="c-gap-right"
                                                                                               style="background-position:0px -324px"></i>中通<span></span>
                </li>
                <li data-value="shunfeng" class="OP_LOG_BTN  op_express_delivery_hot_bottom"><i class="c-gap-right"
                                                                                                style="background-position:0px -180px"></i>顺丰<span></span>
                </li>
            </ul>
        </div>
        <div class="clear"></div>

        <!--支付方式-->
        <div class="logistics">
            <h3>选择支付方式</h3>
            <ul class="pay-list">
                <li class="pay card"><img src="/static/images/wangyin.jpg"/>银联<span></span></li>
                <li class="pay qq"><img src="/static/images/weizhifu.jpg"/>微信<span></span></li>
                <li class="pay taobao"><img src="/static/images/zhifubao.jpg"/>支付宝<span></span></li>
            </ul>
        </div>
        <div class="clear"></div>

        <!--订单 -->
        <section class="cartMain">
            <div class="cartMain_hd">
                {% csrf_token %}
                <ul class="order_lists cartTop">
                    <li class="list_con">商品信息</li>
                    <li class="list_info">商品参数</li>
                    <li class="list_price">单价</li>
                    <li class="list_amount">数量</li>
                    <li class="list_sum">金额</li>
                    <li class="list_op">快递</li>
                </ul>
            </div>

            <div class="cartBox">

                <div class="shop_info">

                    <div class="all_check">
                        <!--店铺全选-->
                        <input type="checkbox" id="shop_a" class="shopChoice">
                        <label for="shop_a" class="shop"></label>
                    </div>
                    <div class="shop_name">
                        店铺：<a href="javascript:;">零食店铺</a>
                    </div>
                </div>
                <div class="order_content">
                    {% for car in car_list %}
                        <ul class="order_lists">
                            <li class="list_chk">
                                <input type="checkbox" id="checkbox_2" class="son_check">
                                <label for="checkbox_2"></label>
                            </li>
                            <li class="list_con">
                                <div class="list_img"><a href="{% url 'detail' %}?sid={{ car.shop.shop_id }}"><img
                                        src="{{ car.img.img_url }}"
                                        alt=""></a></div>
                                <div class="list_text"><a
                                        href="{% url 'detail' %}?sid={{ car.shop.shop_id }}">{{ car.shop.name }}</a>
                                </div>
                            </li>
                            <li class="list_info">
                                <p>规格：默认</p>
                                <p>尺寸：默认</p>
                            </li>
                            <li class="list_price">
                                <p class="price">￥{{ car.shop.promote_price }}</p>
                            </li>
                            <li class="list_amount">
                                <div class="amount_box">
                                    {#                                    <a href="javascript:;" class="reduce reSty" id="sub" car_id="{{ car.car_id }}">-</a>#}
                                    <input type="text" max="{{ car.shop.stock }}" value="{{ car.shop_number }}"
                                           id="{{ car.car_id }}" oid="{{ order.oid }}" name="nums" class="sum">
                                    {#                                    <a href="javascript:;" class="plus" id="add" car_id="{{ car.car_id }}">+</a>#}
                                </div>
                            </li>
                            <li class="list_sum">
                                <p class="sum_price" id="sum_price">￥{{ car.shop_number|multiply:car.shop.promote_price }}</p>
                            </li>
                            <li class="list_op">
                                <p class="del"><a href="javascript:;" class="delBtn" shopid="{{ car.shop.shop_id }}">移除商品</a>
                                </p>
                            </li>
                        </ul>
                    {% endfor %}

                </div>
            </div>
        </section>


        <div class="pay-total">
            <!--留言-->
            <div class="order-extra">
                <div class="order-user-info">
                    <div id="holyshit257" class="memo">
                        <label>买家留言：</label>
                        <input type="text" title="选填,对本次交易的说明（建议填写已经和卖家达成一致的说明）" placeholder="选填,建议填写和卖家达成一致的说明"
                               class="memo-input J_MakePoint c2c-text-default memo-close">
                        <div class="msg hidden J-msg">
                            <p class="error">最多输入500个字符</p>
                        </div>
                    </div>
                </div>

            </div>

            <!--优惠券 -->
            <div class="buy-agio">
                <li class="td td-coupon">

                    <span class="coupon-title">优惠券</span>
                    <select data-am-selected>
                        <option value="a">
                            <div class="c-price">
                                <strong>￥8</strong>
                            </div>
                            <div class="c-limit">
                                【消费满95元可用】
                            </div>
                        </option>
                        <option value="b" selected>
                            <div class="c-price">
                                <strong>￥3</strong>
                            </div>
                            <div class="c-limit">
                                【无使用门槛】
                            </div>
                        </option>
                    </select>
                </li>

                <li class="td td-bonus">

                    <span class="bonus-title">红包</span>
                    <select data-am-selected>
                        <option value="a">
                            <div class="item-info">
                                ¥50.00<span>元</span>
                            </div>
                            <div class="item-remainderprice">
                                <span>还剩</span>10.40<span>元</span>
                            </div>
                        </option>
                        <option value="b" selected>
                            <div class="item-info">
                                ¥50.00<span>元</span>
                            </div>
                            <div class="item-remainderprice">
                                <span>还剩</span>50.00<span>元</span>
                            </div>
                        </option>
                    </select>

                </li>

            </div>
            <div class="clear"></div>
        </div>
        <!--含运费小计 -->
        <div class="buy-point-discharge ">
            <p class="price g_price ">
                合计（含运费） <span>¥</span><em class="pay-sum"></em>
            </p>
        </div>
        <li class="td td-oplist">
            <div class="td-inner">
                <span class="phone-title">配送方式</span>
                <div class="pay-logis">
                    快递<b class="sys_item_freprice">10</b>元
                </div>
            </div>
        </li>
        <!--信息 -->
        <div class="order-go clearfix">
            <div class="pay-confirm clearfix">
                <div class="box">
                    <div tabindex="0" id="holyshit267" class="realPay"><em class="t">实付款：</em>
                        <span class="price g_price ">
                                    <span>¥</span> <em class="style-large-bold-red " id="J_ActualFee"></em>
											</span>
                    </div>

                    <div id="holyshit268" class="pay-address">

                        <p class="buy-footer-address">
                            <span class="buy-line-title buy-line-title-type">寄送至：</span>
                            <span class="buy--address-detail">
								   <span class="province">湖北</span>省
												<span class="city">武汉</span>市
												<span class="dist">洪山</span>区
												<span class="street">雄楚大道666号(中南财经政法大学)</span>
												</span>
                            </span>
                        </p>
                        <p class="buy-footer-address">
                            <span class="buy-line-title">收货人：</span>
                            <span class="buy-address-detail">
                                         <span class="buy-user">艾迪 </span>
												<span class="buy-phone">15871145629</span>
												</span>
                        </p>
                    </div>
                </div>

                <div id="holyshit269" class="submitOrder">
                    <div class="go-btn-wrap">
                        <a id="J_Go" href="{% url 'notify' %}" class="btn-go" tabindex="0" title="点击此按钮，提交订单">提交订单</a>
                    </div>
                </div>
                <div class="clear"></div>
            </div>
        </div>
    </div>

    <div class="clear"></div>
</div>
</div>
</div>
<div class="theme-popover-mask"></div>
<div class="theme-popover">

    <!--标题 -->
    <div class="am-cf am-padding">
        <div class="am-fl am-cf"><strong class="am-text-danger am-text-lg">新增地址</strong> /
            <small>Add address</small>
        </div>
    </div>
    <hr/>

    <div class="am-u-md-16">
        <form class="am-form am-form-horizontal">

            <div class="am-form-group">
                <label for="user-name" class="am-form-label">收货人</label>
                <div class="am-form-content">
                    <input type="text" id="user-name" placeholder="收货人" name="name">
                </div>
            </div>

            <div class="am-form-group">
                <label for="user-phone" class="am-form-label">手机号码</label>
                <div class="am-form-content">
                    <input id="user-phone" placeholder="手机号必填" type="email" name="phone">
                </div>
            </div>

            <div class="am-form-group">
                <label for="user-phone" class="am-form-label">所在地</label>
                <div class="am-form-content address">
                    <select data-am-selected>
                        <option value="a">浙江省</option>
                        <option value="b">湖北省</option>
                    </select>
                    <select data-am-selected>
                        <option value="a">温州市</option>
                        <option value="b">武汉市</option>
                    </select>
                    <select data-am-selected>
                        <option value="a">瑞安区</option>
                        <option value="b">洪山区</option>
                    </select>
                </div>
            </div>

            <div class="am-form-group">
                <label for="user-intro" class="am-form-label">详细地址</label>
                <div class="am-form-content">
                    <textarea class="" rows="3" id="user-intro" placeholder="输入详细地址" name="address"></textarea>
                    <small>100字以内写出你的详细地址...</small>
                </div>
            </div>

            <div class="am-form-group theme-poptit">
                <div class="am-u-sm-12 am-u-sm-push-3">
                    <div class="am-btn am-btn-danger" id="btn_sure">保存</div>
                    <div class="am-btn am-btn-danger close">取消</div>
                </div>
            </div>
        </form>
    </div>

</div>

<div class="clear"></div>
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/carts.js"></script>
<div style="text-align:center;"></div>
<script type="text/javascript">
    $(function () {
        sum_price = 0;
        $('.sum_price').each(function (index, ele) {
            let $sum = $(this).text();
            let num = $sum.substr(1);
            let x = parseFloat(num);
            sum_price = sum_price + x
        });
        $('.pay-sum').append(sum_price);
        $('#J_ActualFee').append(sum_price);
    })
</script>
<script type="text/javascript">

    $(function () {

        $('#J_Go').click(function () {
            let cars = [];
            $('.sum').each(function (index, ele) {
                let $sum = $(this);
                let num = $sum.val();
                let car_id = $sum.attr('id');
                let oid = $sum.attr('oid');
                cars.push({num: num, car_id: car_id, oid: oid})
            });
            if (cars.length > 0) {
                cars_str = JSON.stringify(cars);

                data = {
                    car: cars_str,
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                };
                $.post('{% url 'pay_shop' %}', data, function (result) {
                    if (result.status === 200) {
                        window.location.href = '#'
                    }
                })
            }


        })
    })


</script>
